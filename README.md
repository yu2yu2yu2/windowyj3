# 🛡️ Windows应急响应工具 (增强版)

专业化的Windows系统安全检查和应急响应工具，提供全面的系统安全状况分析和智能威胁检测。

## 🆕 增强功能

### 📊 统计分析功能
- **用户权限统计** - 详细统计用户账户数量、管理员权限分配情况
- **进程安全统计** - 统计系统进程、可疑进程、高CPU占用进程数量
- **网络连接统计** - 统计网络连接、监听端口、可疑连接数量
- **安全风险评估** - 基于统计数据进行风险评分和等级评估
- **专业安全建议** - 根据统计结果提供针对性的安全建议

### 🔍 增强检测规则
- **管理员权限检测** - 检测超级管理员权限用户，识别权限过度分配
- **用户安全分析** - 分析用户登录情况，识别僵尸账户和异常账户
- **进程行为分析** - 增强可疑进程检测，支持更多威胁模式
- **网络安全监控** - 检测高风险端口、外网连接、可疑网络活动
- **安全防护状态** - 检测Windows Defender、防火墙、UAC等安全功能状态

### 💡 专业分析报告
- **真实场景模拟** - 分析结果更贴近真实安全场景
- **专业建议生成** - 提供具体的处置步骤和安全建议
- **风险等级评估** - 基于多维度数据进行风险评分
- **统计图表展示** - 直观展示系统安全状况统计信息

## 🌟 核心特性

### 📊 全面的系统检查
- **系统信息收集** - 操作系统版本、补丁信息、硬件配置
- **用户权限分析** - 本地用户、管理员权限、登录记录
- **进程服务检查** - 运行进程、系统服务、启动项分析
- **网络连接监控** - 活跃连接、监听端口、网络配置
- **文件系统扫描** - 可疑文件、系统完整性检查
- **注册表分析** - 启动项、服务配置、安全策略
- **日志深度分析** - Windows事件日志、安全日志
- **计划任务审查** - 系统计划任务、可疑任务检测
- **恶意软件检测** - Windows Defender状态、异常进程

### 🔍 智能威胁检测
- **专业规则库** - 基于Windows安全最佳实践的检测规则
- **行为分析** - 识别异常的系统行为和进程活动
- **网络监控** - 检测可疑的网络连接和通信
- **持久化检测** - 发现恶意的持久化机制

### 💡 专业处置建议
- **分类建议** - 按安全类别提供针对性建议
- **优先级排序** - 根据威胁级别排序处置建议
- **操作指导** - 详细的处置步骤和命令

### 📚 技术教程系统
- **排查指南** - 每个模块都有详细的技术教程
- **命令参考** - 实用的PowerShell命令和技巧
- **安全建议** - 基于最佳实践的安全建议
- **注意事项** - 重要的安全注意事项

## 🚀 快速开始

### 环境要求
- Windows 10/11 或 Windows Server 2016+
- PowerShell 5.1 或更高版本
- Python 3.7+ (用于Web界面)
- 管理员权限

### 安装步骤

#### 1. 克隆项目
```bash
git clone https://github.com/ssssssda/window_emergency.git
cd window_emergency
```

#### 2. 安装Python依赖
```bash
pip install flask flask-cors
```

#### 3. 运行PowerShell脚本生成报告
```powershell
# 以管理员身份运行PowerShell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 运行应急响应脚本
.\windows_emergency_response.ps1

# 生成详细报告
.\windows_emergency_response.ps1 -Detailed -JsonOutput
```

#### 4. 启动Web服务器
```bash
python windows_rules_engine.py
```

### 5. 访问Web界面
```
浏览器打开: http://localhost:12001
详细版查看器: http://localhost:12001/viewer
```

## 🎯 两种使用方式

### 📤 方式一：快速分析
1. 访问 `http://localhost:12001`
2. 上传PowerShell脚本生成的报告文件
3. 查看智能分析结果和安全告警

### 📋 方式二：详细版查看器（推荐）
1. 访问 `http://localhost:12001/viewer`
2. 上传报告文件
3. 享受完整功能：
   - 📊 **系统安全概览** - 全面的安全状况分析
   - 🔍 **详细检查报告** - 所有检查项目的详细结果
   - 📚 **专业技术教程** - 每个模块的排查指南和命令参考
   - 🚨 **智能告警系统** - 实时安全威胁检测和告警
   - 🔎 **全文搜索功能** - 快速定位关键信息
   - 💡 **专业处置建议** - 基于威胁类型的处置建议

## 📋 检查模块详解

### 💻 系统信息模块
- 操作系统版本和构建信息
- 已安装的安全补丁
- 系统启动时间和运行状态
- 重要环境变量检查
- 硬件配置信息

### 👥 用户权限模块
- 本地用户账户列表
- 管理员组成员检查
- 当前登录用户分析
- 最近登录记录审查
- 用户权限分配检查

### ⚙️ 进程服务模块
- 高CPU占用进程分析
- 可疑进程行为检测
- 系统服务状态检查
- 启动项合法性验证
- 进程网络连接关联

### 🌐 网络连接模块
- 活跃网络连接监控
- 监听端口安全检查
- 网络接口配置验证
- DNS设置安全检查
- 防火墙状态检查

### 📁 文件系统模块
- 系统文件完整性检查
- 临时目录可疑文件扫描
- 下载目录安全审查
- 文件权限异常检测
- 隐藏文件发现

### 📋 注册表模块
- 启动项注册表检查
- 系统服务注册表审查
- 安全策略配置验证
- 文件关联检查
- 最近访问文件记录

### 📊 日志分析模块
- Windows安全日志分析
- 登录失败事件检测
- 系统错误事件分析
- 应用程序日志检查
- 事件时间线重建

### ⏰ 计划任务模块
- 活跃计划任务检查
- 可疑任务行为分析
- 任务权限验证
- 任务触发条件检查
- 任务执行内容审查

### 🦠 恶意软件检测模块
- Windows Defender状态检查
- 可疑网络连接检测
- 异常进程行为分析
- 恶意文件特征识别
- 系统完整性验证

## 🔧 高级用法

### PowerShell脚本参数
```powershell
# 基本用法
.\windows_emergency_response.ps1

# 指定输出文件
.\windows_emergency_response.ps1 -OutputPath "custom_report.txt"

# 生成详细报告
.\windows_emergency_response.ps1 -Detailed

# 生成JSON格式报告
.\windows_emergency_response.ps1 -JsonOutput

# 组合参数
.\windows_emergency_response.ps1 -OutputPath "detailed_report.txt" -Detailed -JsonOutput
```

### Web服务器配置
```python
# 修改端口
port = 12001

# 启用调试模式
app.run(debug=True)

# 配置CORS
CORS(app, origins=['http://localhost:3000'])
```

## 🛡️ 安全建议

### 运行环境安全
- 在隔离的环境中运行分析
- 使用专用的应急响应工作站
- 确保工具本身的完整性
- 定期更新检测规则

### 数据保护
- 妥善保管生成的报告文件
- 避免在不安全的网络中传输报告
- 及时清理临时文件
- 遵循数据保护法规

### 操作规范
- 以管理员权限运行PowerShell脚本
- 在分析过程中避免进行其他操作
- 记录分析过程和发现的问题
- 建立标准的应急响应流程

## 📚 技术文档

### PowerShell脚本架构
- 模块化设计，每个功能独立
- 错误处理和异常捕获
- 详细的日志记录
- 灵活的输出格式

### Web界面技术栈
- 后端：Python Flask框架
- 前端：原生HTML/CSS/JavaScript
- 数据格式：JSON/文本
- 通信：RESTful API

### 规则引擎设计
- 基于正则表达式的模式匹配
- 可扩展的规则库
- 威胁级别分类
- 智能建议生成

## 🤝 贡献指南

### 添加新的检测规则
1. 在 `WINDOWS_SECURITY_RULES` 中添加规则
2. 定义规则ID、名称、描述和模式
3. 设置威胁级别和分类
4. 测试规则的准确性

### 扩展检查模块
1. 在PowerShell脚本中添加新函数
2. 实现数据收集和分析逻辑
3. 更新Web界面的解析函数
4. 添加相应的教程内容

### 改进用户界面
1. 优化CSS样式和布局
2. 增强JavaScript交互功能
3. 改进数据可视化
4. 提升用户体验

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🆘 支持与反馈

如果您在使用过程中遇到问题或有改进建议，请：

1. 查看文档和FAQ
2. 提交Issue到GitHub仓库
3. 参与社区讨论
4. 贡献代码和改进

## 🔄 更新日志

### v1.0.0 (2024-12-06)
- 🎉 首次发布
- ✅ 完整的Windows应急响应检查功能
- ✅ Web界面和详细版查看器
- ✅ 智能威胁检测和处置建议
- ✅ 专业技术教程系统
- ✅ 全文搜索和数据分析功能

---

**⚠️ 免责声明**: 本工具仅用于合法的安全检查和应急响应目的。使用者应确保遵守相关法律法规，并对使用本工具的后果承担责任。