# Windows应急响应数据收集器使用指南

## 📋 概述

本工具包提供了多种格式的Windows应急响应数据收集脚本，用于快速收集系统安全信息，支持威胁检测和安全分析。

## 🚀 快速开始

### 方法1: 一键运行 (推荐)
```bash
# 双击运行或在命令行执行
run_emergency_collector.bat
```

### 方法2: 选择特定版本
根据你的环境选择合适的脚本：

#### PowerShell版本 (推荐)
```powershell
# 以管理员身份运行PowerShell
powershell -ExecutionPolicy Bypass -File windows_emergency_collector.ps1 -Verbose
```

#### Python版本
```bash
# 先安装依赖
install_python_deps.bat

# 运行收集器
python windows_emergency_collector.py --verbose
```

#### 批处理版本
```bash
# 双击运行或命令行执行
windows_emergency_collector.bat
```

#### VBScript版本
```bash
# 命令行执行
cscript //nologo windows_emergency_collector.vbs
```

## 📊 脚本对比

| 脚本类型 | 功能完整度 | 兼容性 | 依赖要求 | 推荐度 |
|---------|-----------|--------|----------|--------|
| PowerShell | ⭐⭐⭐⭐⭐ | Windows 7+ | 内置 | 🥇 最推荐 |
| Python | ⭐⭐⭐⭐⭐ | 跨平台 | Python + psutil | 🥈 推荐 |
| 批处理 | ⭐⭐⭐⭐ | 所有Windows | 无 | 🥉 兼容性最佳 |
| VBScript | ⭐⭐⭐ | Windows XP+ | 内置 | 轻量级选择 |

## 🔍 收集的信息类型

### 1. 系统基本信息
- 计算机名、用户名、域信息
- 操作系统版本和架构
- 硬件配置信息
- 系统目录和临时目录

### 2. 用户账户信息 ⚠️ 重点检查
- 本地用户账户详情
- 管理员权限分配
- 可疑管理员账户检测
- 用户登录状态分析

### 3. 进程信息 ⚠️ 重点检查
- 当前运行进程列表
- 进程路径和命令行参数
- 可疑进程检测 (PowerShell, CMD等)
- 异常路径进程识别

### 4. 网络连接信息 ⚠️ 重点检查
- 活动网络连接
- 可疑外网连接检测
- 异常端口连接识别
- 网络适配器配置

### 5. 文件系统检查 ⚠️ 重点检查
- 临时目录可疑文件扫描
- 可执行文件检测
- 文件创建和修改时间
- 文件大小和路径分析

### 6. 系统服务检查
- 运行中的系统服务
- 可疑服务名称检测
- 服务启动类型分析
- 服务路径验证

### 7. 计划任务检查
- 系统计划任务列表
- 可疑任务操作检测
- 任务执行路径分析
- 任务状态监控

### 8. Windows Defender状态
- 实时保护状态
- 反恶意软件状态
- 防火墙状态
- 签名版本信息

### 9. 注册表启动项检查
- 系统启动项扫描
- 可疑启动项检测
- 注册表路径分析
- 启动命令验证

### 10. 系统日志摘要
- 安全事件统计
- 登录失败检测
- 系统错误分析
- 异常活动识别

## 🎯 检测规则说明

工具会自动检测以下可疑活动：

### 高危告警
- 异常管理员账户 (包含test、temp、hack等关键词)
- 可疑网络连接 (外网IP、异常端口)
- Windows Defender关闭

### 中危告警
- 可疑进程活动 (PowerShell、CMD长时间运行)
- 临时目录可疑文件
- 异常进程路径
- 可疑计划任务
- 异常系统服务

### 低危告警
- 管理员账户过多
- 从未登录用户异常
- 高权限用户检测

## 📁 输出文件

所有脚本都会生成 `windows_emergency_report.txt` 文件，包含：

1. **报告头部**: 生成时间、系统信息
2. **详细数据**: 按模块组织的系统信息
3. **可疑标记**: 自动标记的异常项目
4. **统计信息**: 各类数据的统计汇总
5. **报告尾部**: 执行时间、文件大小等

## 🔧 使用建议

### 运行环境
- **推荐**: 以管理员权限运行，获取完整信息
- **最低**: 普通用户权限，部分信息可能受限

### 执行频率
- **应急响应**: 发现安全事件时立即执行
- **定期检查**: 建议每周或每月执行一次
- **系统变更后**: 重要系统变更后执行

### 数据分析
1. **自动分析**: 将报告文件上传到 `/viewer` 界面
2. **人工分析**: 查看报告中的 ⚠️ 标记项目
3. **对比分析**: 与历史报告对比，发现变化

## 🚨 应急响应流程

### 1. 快速检查 (5分钟内)
```bash
# 运行一键收集器
run_emergency_collector.bat
# 选择 "5. 自动选择最佳方案"
```

### 2. 上传分析 (2分钟内)
- 将生成的 `windows_emergency_report.txt` 上传到 `/viewer` 界面
- 查看自动生成的安全告警和处置建议

### 3. 应急处置 (根据告警级别)
- **高危告警**: 立即隔离系统，联系安全团队
- **中危告警**: 深入分析，制定处置计划
- **低危告警**: 记录问题，安排后续处理

## 🛠️ 故障排除

### PowerShell执行策略问题
```powershell
# 临时允许脚本执行
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
```

### Python依赖问题
```bash
# 运行依赖安装脚本
install_python_deps.bat
```

### 权限不足问题
- 右键选择"以管理员身份运行"
- 或使用 `runas` 命令

### 脚本文件缺失
- 确保所有脚本文件在同一目录
- 重新下载完整的工具包

## 📞 技术支持

如遇到问题，请：

1. 检查系统兼容性
2. 确认管理员权限
3. 查看错误信息
4. 尝试其他版本的脚本
5. 联系技术支持团队

## 🔒 安全说明

- 本工具仅收集系统信息，不会修改系统配置
- 生成的报告可能包含敏感信息，请妥善保管
- 建议在隔离环境中分析可疑文件
- 定期更新工具以获得最新的检测规则

## 📝 更新日志

### v2.0 Enhanced
- ✅ 新增多种脚本格式支持
- ✅ 增强可疑活动检测规则
- ✅ 添加自动化分析功能
- ✅ 优化报告格式和可读性
- ✅ 增加一键运行功能

---

**🛡️ 保护您的Windows系统安全，从应急响应开始！**